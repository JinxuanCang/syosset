= content_for :title, @department.name
= content_for :description, truncate(strip_tags(@department.content), length: 200)

.page-wrapper
  %header.page-heading.clearfix
    %h1.heading-title.pull-left= @department.name
    = render partial: "partials/modtools", locals: {actions: @actions}
    %ul.nav.navbar-nav.pull-right
      %li
        - if user_signed_in?
          - if @department.subscriber? current_user
            %a{:href => unsubscribe_department_path(@department), data: {method: 'post'}} Unsubscribe
          - else
            %a{:href => subscribe_department_path(@department), data: {method: 'post'}} Subscribe
  .page-content
    .row.page-row
      .courses-wrapper.col-md-8.col-sm-7
        = form_for [:admin, @department] do |f|
          %div{class: "#{"editable-content" if current_holder.can? :edit, @department}", id: "department[content]"}
            = @department.content.html_safe
        - unless @department.courses.empty?
          %h3
            = link_to "Courses", department_courses_path(@department)
            %small
              = link_to department_courses_path(@department) do
                %i.fa.fa-ellipsis-v
                See all
          %input.course-search.form-control{type: 'text', placeholder: 'Search courses'}
          %hr
          - @department.courses.in_groups_of(4).each_with_index do |courses, index|
            .row
              - courses.compact.each do |course|
                .col-xs-6.col-md-3.course{data: {name: course.name, course_id: course.course_id}, class: index >= 2 ? 'hidden' : ''}
                  = link_to course.name.truncate(50), course, class: "thumbnail"
          .pull-right
            - excess_courses = @department.courses.count - 8
            - if excess_courses >= 1
              = link_to "javascript:;", id: "show-more-courses" do
                %i.fa.fa-ellipsis-h
                = "Show #{excess_courses} more courses"

      %aside.page-sidebar.col-md-3.col-md-offset-1.col-sm-4.col-sm-offset-1
        %section.widget.has-divider
          %h3.title
            %i.fa.fa-phone
            Contact Department
          %p
            Call us at
            = @department.phone
        %section.widget.has-divider
          %h3.title
            %i.fa.fa-bell
            = link_to "Announcements", announcements_path(department_id: @department.id)
          %ul.rankable.list-group
            - @department.announcements.by_priority.limit(5).each do |announcement|
              = content_tag_for(:li, announcement, class: "list-group-item") do
                - if current_holder.can?(:edit, announcement)
                  %i.handle.fa.fa-sort{"aria-hidden" => "true"}
                = link_to announcement.name.truncate(38), announcement
        %section.widget.has-divider
          %h3.title
            %i.fa.fa-link
            = link_to "Links", links_path(department_id: @department.id)
            %small
              = link_to links_path(department_id: @department.id) do
                %i.fa.fa-ellipsis-v
                See all
          %ul.rankable.list-group
            - @department.links.by_priority.limit(5).each do |link|
              = content_tag_for(:li, link, class: "list-group-item") do
                - if current_holder.can?(:edit, link)
                  %i.handle.fa.fa-sort{"aria-hidden" => "true"}
                  = link_to link_path(link), method: :delete, data: { confirm: 'Are you sure?' } do
                    %i.fa.fa-times
                  = link_to new_admin_escalation_request_path(link_id: link) do
                    - if link.escalated?
                      %i.fa.fa-star
                    - else
                      %i.fa.fa-star-o
                = link_to link.name, link.target
:javascript
  init_tiny();
  $(document).on('turbolinks:load', function() {
    $("#show-more-courses").click(function() {
      $(".course").removeClass('hidden');
      $("#show-more-courses").addClass('hidden');
    });
  });
